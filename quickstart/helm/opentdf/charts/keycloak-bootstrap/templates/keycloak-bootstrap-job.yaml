apiVersion: batch/v1
kind: Job
metadata:
  name: {{ .Values.name }}
  labels:
    chart: "{{ $.Chart.Name }}-{{ $.Chart.Version }}"
    release: "{{ $.Release.Name }}"
    heritage: "{{ $.Release.Service }}"
spec:
  template:
    spec:
      containers:
        - name: {{ .Values.name }}
          imagePullPolicy: {{ .Values.image.pullPolicy }}
          image: {{ .Values.image.name }}
          env:
            - name: keycloak_hostname
              value: {{ .Values.keycloak.hostname }}
            - name: keycloak_admin_username
              value: {{ .Values.keycloak.username }}
            - name: keycloak_admin_password
              value: {{ .Values.keycloak.password }}
            - name: CLIENT_ID
              value: {{ .Values.keycloak.clientId }}
            - name: CLIENT_SECRET
              value: {{ .Values.keycloak.clientSecret }}
            - name: realm
              value: {{ .Values.keycloak.realm }}
      restartPolicy: Never
      {{ if .Values.image.pullSecret }}
      imagePullSecrets:
        - name: {{ .Values.image.pullSecret }}
      {{ end }}
  backoffLimit: 6

